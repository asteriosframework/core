
# Select what we should cache between builds
cache:
  key: build_cache
  paths:
    - vendor/
    - node_modules

# Run our tests
# If Xdebug was installed you can generate a coverage report and see code coverage metrics.
test:
  stage: build
  image: php:latest
  services:
    - name: mariadb:10.4
      alias: db
      variables:
        MARIADB_USER: db
        MARIADB_PASSWORD: db
        MARIADB_ROOT_PASSWORD: db
        MARIADB_DATABASE: db
  variables:
    XDEBUG_MODE: coverage
  script:
    - XDEBUG_MODE=coverage ./vendor/bin/phpunit --colors=never -c ./phpunit.xml --coverage-text ./tests
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.cobertura.xml
